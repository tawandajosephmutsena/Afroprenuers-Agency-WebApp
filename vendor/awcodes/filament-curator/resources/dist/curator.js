function a({statePath:l,types:o,initialSelection:n=null,isMultiple:r=!1,directory:c=null}){return{statePath:l,types:o,isMultiple:r,directory:c,selected:[],files:[],nextPageUrl:null,isFetching:!1,showEditForm:!1,showUploadForm:!0,async init(){await this.getFiles("/curator/media",n),new IntersectionObserver(([t])=>{t.isIntersecting&&this.loadMoreFiles()},{rootMargin:"0px",threshold:[0]}).observe(this.$refs.loadMore),this.$watch("selected",t=>{t.length===1?(this.$wire.setSelection(t),this.showEditForm=!0,this.showUploadForm=!1):t.length>1?(this.$wire.setSelection([]),this.showEditForm=!1,this.showUploadForm=!1):(this.$wire.setSelection([]),this.showEditForm=!1,this.showUploadForm=!0)}),n?.length>0&&(this.selected=n)},getIndicator:function(e){return e.includes("?")?"&":"?"},getFiles:async function(e="/curator/media",t=[]){this.$nextTick(async()=>{t.length>0&&(e=e+this.getIndicator(e)+"media="+t.map(h=>h.id).join(",")),this.directory&&(e=e+this.getIndicator(e)+"directory="+this.directory),this.types&&(e=e+this.getIndicator(e)+"types="+this.types.join(",")),this.isFetching=!0;let s=await(await fetch(e)).json();this.files=this.files?this.files.concat(s.data):s.data,this.nextPageUrl=s.next_page_url,this.isFetching=!1})},loadMoreFiles:async function(){this.nextPageUrl&&(this.isFetching=!0,await this.getFiles(this.nextPageUrl,this.selected?.id),this.isFetching=!1)},searchFiles:async function(e){this.isFetching=!0;let t="/curator/media/search?q="+e.target.value;if(this.directory){let h=t.includes("?")?"&":"?";t=t+h+"directory="+this.directory}let s=await(await fetch(t)).json();this.files=s.data,this.isFetching=!1},addNewFile:function(e=null){e&&(this.files=[...e,...this.files],this.$nextTick(()=>{this.addToSelection(e[0].id)}))},removeFile:function(e=null){e&&(this.files=this.files.filter(t=>t.id!=e.id),this.removeFromSelection(e.id))},addToSelection:function(e=null,t=null){if(this.selected.length===1&&!this.isMultiple){this.selected=[this.files.find(i=>i.id==e)];return}if(t&&t.metaKey){this.selected.push(this.files.find(i=>i.id==e));return}this.selected=[this.files.find(i=>i.id==e)]},removeFromSelection:function(e=null){this.selected=this.selected.filter(t=>t.id!=e)},isSelected:function(e=null){return this.selected.length===0?!1:this.selected.find(t=>t.id==e)!==void 0},insertMedia:function(){this.$dispatch("insert-media",{statePath:this.statePath,media:this.selected})}}}export{a as default};
